language: php
 
php:
  - 7.1.3

env:
 global:
  - USER="Travis CI"
  - EMAIL="builds@travis-ci.org"
  - MESSAGE = "Tag Generated from TravisCI for build $TRAVIS_BUILD_NUMBER"
  
install:
 - export CI_BUILD_NUMBER="$TRAVIS_BUILD_NUMBER"
 - export CI_PULL_REQUEST="$TRAVIS_PULL_REQUEST"
 - export CI_BRANCH="$TRAVIS_BRANCH"
 - curl -s http://getcomposer.org/installer | php
 - php composer.phar install --dev --no-interaction
 - composer require php-coveralls/php-coveralls

script:
 - rm -rf build/
 - mkdir -p build/logs
 - echo "Starting php lint check for php files in current and sub directories"
 - find . -name "*.php" -type f -exec php -l {} \;
 - echo "PHP lint check completed successfully"
 - phpunit --configuration phpunit.xml

after_success:
 - travis_retry php vendor/bin/php-coveralls -v
 - git config user.email ${EMAIL}
 - git config user.name ${USER}
 - echo $MESSAGE >> build/build.log
 - git add build/
 - git commit -m "Update build version and unit test logs file for build #$TRAVIS_BUILD_NUMBER"
 - git push